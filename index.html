<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kỉ niệm 12A9</title>
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <h2>12A9</h2>
      </div>
      <button class="nav-toggle" type="button" aria-label="Toggle navigation" aria-expanded="false">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
      <ul class="nav-menu" role="navigation">
        <li><a href="#home" class="nav-link active" aria-current="page">Trang chủ</a></li>
        <li><a href="#gallery" class="nav-link">Thư viện ảnh/video</a></li>
        <li><a href="#messages" class="nav-link">Lời nhắn</a></li>
        <li><a href="#write-message" class="nav-link">Viết tâm thư</a></li>
      </ul>
    </div>
  </nav>

  <!-- Background Music Control -->
  <div class="music-control">
    <button type="button" onclick="toggleMusic()" aria-label="Toggle background music" class="music-btn">
      <i class="fas fa-music"></i>
    </button>
  </div>

  <!-- Background Music -->
  <audio id="background-music" loop>
    <source src="audio/nhac_nen_tinh_ban_dieu_ky.mp3" type="audio/mp3">
    <source src="audio/nhac_nen_tinh_ban_dieu_ky.ogg" type="audio/ogg">
  </audio>

  <!-- Floating Background Elements -->
  <div class="bg-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <!-- Home Section -->
  <section id="home" class="section active">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">Lớp 12A9</h1>
        <p class="hero-subtitle">Những kỷ niệm đẹp nhất tuổi học trò</p>
        <div class="hero-stats">
          <div class="stat-item">
            <h3>52</h3>
            <p>Thành viên</p>
          </div>
          <div class="stat-item">
            <h3>3</h3>
            <p>Năm học</p>
          </div>
          <div class="stat-item">
            <h3>∞</h3>
            <p>Kỷ niệm</p>
          </div>
        </div>
      </div>
      <div class="members-grid" id="members-grid">
        <!-- Member cards will be inserted here by JavaScript -->
      </div>
    </div>
  </section>

  <!-- Gallery Section -->
  <section id="gallery" class="section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Thư viện ảnh/video</h2>
        <p class="section-subtitle">Những khoảnh khắc đáng nhớ</p>
      </div>

      <!-- Video Gallery -->
      <div class="content-block">
        <h3 class="content-title">Video kỷ niệm</h3>
        <div class="media-grid video-grid" id="video-grid">
          <!-- Video items will be inserted here by JavaScript -->
        </div>
      </div>

      <!-- Photo Gallery -->
      <div class="content-block">
        <h3 class="content-title">Ảnh kỷ niệm</h3>
        <div class="media-grid photo-grid" id="photo-grid">
          <!-- Photo items will be inserted here by JavaScript -->
        </div>
      </div>
    </div>
  </section>

  <!-- Messages Section -->
  <section id="messages" class="section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Lời nhắn</h2>
        <p class="section-subtitle">Những tâm sự chân thành</p>
      </div>
      <div class="messages-grid" id="messages-grid">
        <!-- Message cards will be inserted here by JavaScript -->
      </div>
    </div>
  </section>

  <!-- Write Message Section -->
  <section id="write-message" class="section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Viết tâm thư</h2>
        <p class="section-subtitle">Chia sẻ những kỷ niệm của bạn</p>
      </div>
      <div class="write-form">
        <div class="form-group">
          <label for="name">Tên của bạn</label>
          <input type="text" id="name" placeholder="Nhập tên của bạn" required>
        </div>
        <div class="form-group">
          <label for="message">Lời nhắn nhủ</label>
          <textarea id="message" placeholder="Chia sẻ những kỷ niệm, cảm xúc của bạn..." required></textarea>
        </div>
        <button type="button" onclick="submitMessage()" class="submit-btn">
          <i class="fas fa-paper-plane"></i>
          Gửi tâm thư
        </button>
      </div>

      <div id="submitted-messages" class="submitted-messages"></div>
    </div>
  </section>

  <!-- Modals -->
  <!-- Member Detail Modal -->
  <div id="memberModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeMemberModal()">
        <i class="fas fa-times"></i>
      </button>
      <div class="member-detail">
        <div class="member-avatar">
          <img id="modalAvatar" src="" alt="Avatar">
        </div>
        <h2 id="modalName"></h2>
        <div class="member-info">
          <p id="modalAge"></p>
          <p id="modalDob"></p>
          <p id="modalStrength"></p>
          <p id="modalWeakness"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Video Modal -->
  <div id="video-modal" class="modal">
    <div class="modal-content video-modal">
      <button class="modal-close" onclick="closeVideoModal()">
        <i class="fas fa-times"></i>
      </button>
      <h3 id="video-modal-title"></h3>
      <video id="video-modal-player" controls muted playsinline>
        <source id="video-modal-source" src="" type="video/mp4">
      </video>
      <p id="video-modal-description"></p>
    </div>
  </div>

  <!-- Image Modal -->
  <div id="image-modal" class="modal">
    <div class="modal-content image-modal">
      <button class="modal-close" onclick="closeImageModal()">
        <i class="fas fa-times"></i>
      </button>
      <h3 id="image-modal-title"></h3>
      <img id="image-modal-img" src="" alt="">
      <p id="image-modal-description"></p>
    </div>
  </div>

  <!-- Message Modal -->
  <div id="message-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeMessageModal()">
        <i class="fas fa-times"></i>
      </button>
      <h3 id="modal-name"></h3>
      <div class="message-content">
        <p id="modal-message"></p>
      </div>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>Đang tải...</p>
  </div>

  <script src="script.js"></script>
  <!-- Firebase Scripts -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getDatabase, ref, push, onChildAdded, query, limitToLast } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    document.addEventListener("DOMContentLoaded", () => {
      const firebaseConfig = {
        apiKey: "AIzaSyDGl114VDUnvUtVdl7vNd35lHEgXQIdaKs",
        authDomain: "tuquangmemmery.firebaseapp.com",
        projectId: "tuquangmemmery",
        databaseURL: "https://tuquangmemmery-default-rtdb.firebaseio.com/",
        storageBucket: "tuquangmemmery.appspot.com",
        messagingSenderId: "280703846268",
        appId: "1:280703846268:web:d4fc49d0750dcea82a46f9",
        measurementId: "G-W04JHPDT9Z"
      };

      let database;
      try {
        const app = initializeApp(firebaseConfig);
        database = getDatabase(app);
        console.log("Firebase initialized successfully");
      } catch (error) {
        console.error("Firebase initialization error:", error);
        return;
      }

      const submittedMessages = document.getElementById("submitted-messages");

      window.submitMessage = async function() {
        if (!database) {
          showNotification("Không thể gửi tin nhắn do lỗi kết nối!", "error");
          return;
        }
        
        const nameInput = document.getElementById("name");
        const messageInput = document.getElementById("message");
        const name = nameInput.value.trim();
        const message = messageInput.value.trim();
        
        if (name && message) {
          const newMessage = {
            name,
            message,
            timestamp: new Date().toLocaleString("vi-VN", { timeZone: "Asia/Ho_Chi_Minh" })
          };
          
          try {
            await push(ref(database, 'messages'), newMessage);
            nameInput.value = "";
            messageInput.value = "";
            
            showNotification("Tâm thư đã được gửi thành công!", "success");
          } catch (error) {
            console.error("Lỗi khi gửi tin nhắn:", error);
            showNotification("Không thể gửi tin nhắn!", "error");
          }
        } else {
          showNotification("Vui lòng nhập đầy đủ thông tin!", "warning");
        }
      };

      function displayMessages() {
        if (!database || !submittedMessages) return;
        
        const maxMessages = 50;
        onChildAdded(query(ref(database, 'messages'), limitToLast(maxMessages)), (snapshot) => {
          const msg = snapshot.val();
          const messageDiv = document.createElement("div");
          messageDiv.classList.add("message-item");
          messageDiv.innerHTML = `
            <div class="message-header">
              <strong>${msg.name}</strong>
              <span class="message-time">${msg.timestamp}</span>
            </div>
            <p class="message-text">${msg.message}</p>
          `;
          messageDiv.addEventListener("click", () => showMessage(msg.name, msg.message));
          submittedMessages.insertBefore(messageDiv, submittedMessages.firstChild);
          
          if (submittedMessages.children.length > maxMessages) {
            submittedMessages.removeChild(submittedMessages.lastChild);
          }
        });
      }

      displayMessages();
    });
  </script>
</body>
</html>
